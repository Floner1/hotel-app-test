<!DOCTYPE HTML>
<html>
  <head>
    {% load static %}
    {% load humanize %}
    <!-- Meta tags for character encoding and responsive design -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{{ hotel.hotel_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=|Roboto+Sans:400,700|Playfair+Display:400,700">

    <!-- Load Django static files -->
    {% load static %}

    <!-- CSS Dependencies -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/aos.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.timepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/fancybox.min.css' %}">

    <!-- Icon Fonts -->
    <link rel="stylesheet" href="{% static 'fonts/ionicons/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/fontawesome/css/font-awesome.min.css' %}">

    <!-- Main Theme Style -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
  </head>
  <body>

    <!-- Main Navigation Header -->
    <header class="site-header js-site-header">
      <div class="container-fluid">
        <div class="row align-items-center">
          <!-- Hotel Logo/Name -->
          <div class="col-6 col-lg-4 site-logo" data-aos="fade"><a href="{% url 'home' %}">{{ hotel.hotel_name }}</a></div>
          <div class="col-6 col-lg-8">
            <!-- Mobile Menu Toggle Button -->
            <div class="site-menu-toggle js-site-menu-toggle"  data-aos="fade">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <!-- END menu-toggle -->

            <!-- Main Navigation Menu -->
            <div class="site-navbar js-site-navbar">
              <nav role="navigation">
                <div class="container">
                  <div class="row full-height align-items-center">
                    <div class="col-md-6 mx-auto">
                      <!-- Navigation Links -->
                      <ul class="list-unstyled menu">
                        <li><a href="{% url 'home' %}">Home</a></li>
                        <li><a href="{% url 'rooms' %}">Rooms</a></li>
                        <li><a href="{% url 'about' %}">About</a></li>
                        <li><a href="{% url 'contact' %}">Contact</a></li>
                        <li class="active"><a href="{% url 'reservation' %}">Reservation</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- END head -->

    <section class="site-hero inner-page overlay" style="background-image: url({% static 'images/hero_4.jpg' %})" data-stellar-background-ratio="0.5">
      <div class="container">
        <div class="row site-hero-inner justify-content-center align-items-center">
          <div class="col-md-10 text-center" data-aos="fade">
            <h1 class="heading mb-3">Reservation Form</h1>
            <ul class="custom-breadcrumbs mb-4">
              <li><a href="{% url 'home' %}">Home</a></li>
              <li>&bullet;</li>
              <li>Reservation</li>
            </ul>
          </div>
        </div>
      </div>

      <a class="mouse smoothscroll" href="#next">
        <div class="mouse-icon">
          <span class="mouse-wheel"></span>
        </div>
      </a>
    </section>
    <!-- END section -->

    <!-- Main Reservation Form Section -->
    <section class="section contact-section" id="next">
      <div class="container">
        <div class="row">
          <!-- Reservation Form Column -->
          <div class="col-md-7" data-aos="fade-up" data-aos-delay="100">
            <!-- Main Booking Form -->
            <form id="reservation-form" action="{% url 'reservation' %}" method="post" class="bg-white p-md-5 p-4 mb-5 border">
              {% csrf_token %}
              <!-- Success/Error Messages -->
              <div id="form-messages" class="mb-3" style="display: none;"></div>

              <!-- Name and Phone Fields -->
              <div class="row">
                <div class="col-md-6 form-group">
                  <label class="text-black font-weight-bold" for="name">Name <span style="color: red;">*</span></label>
                  <input type="text" id="name" name="name" class="form-control" required>
                </div>
                <div class="col-md-6 form-group">
                  <label class="text-black font-weight-bold" for="phone">Phone <span style="color: red;">*</span></label>
                  <input type="text" id="phone" name="phone" class="form-control" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12 form-group">
                  <label class="text-black font-weight-bold" for="email">Email <span style="color: red;">*</span></label>
                  <input type="email" id="email" name="email" class="form-control" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 form-group">
                  <label class="text-black font-weight-bold" for="checkin_date">Date Check In <span style="color: red;">*</span></label>
                  <input type="text" id="checkin_date" name="checkin_date" class="form-control" required>
                </div>
                <div class="col-md-6 form-group">
                  <label class="text-black font-weight-bold" for="checkout_date">Date Check Out <span style="color: red;">*</span></label>
                  <input type="text" id="checkout_date" name="checkout_date" class="form-control" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 form-group">
                  <label for="adults" class="font-weight-bold text-black">Adults <span style="color: red;">*</span></label>
                  <div class="field-icon-wrap">
                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                    <select name="adults" id="adults" class="form-control">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4+</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6 form-group">
                  <label for="children" class="font-weight-bold text-black">Children</label>
                  <div class="field-icon-wrap">
                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                    <select name="children" id="children" class="form-control">
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4+</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12 form-group">
                  <label for="room_type" class="font-weight-bold text-black">Room Type <span style="color: red;">*</span></label>
                  <div class="field-icon-wrap">
                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                    <select name="room_type" id="room_type" class="form-control" required>
                      <option value="">Select a room type</option>
                      {% for room in room_types %}
                      <option value="{{ room.canonical }}">{{ room.display }}{% if room.price %} - ₫{{ room.price|floatformat:0|intcomma }}/night{% endif %}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="row mb-4">
                <div class="col-md-12 form-group">
                  <label class="text-black font-weight-bold" for="notes">Notes</label>
                  <textarea name="notes" id="notes" class="form-control" cols="30" rows="8"></textarea>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 form-group">
                  <input type="submit" value="Reserve Now" class="btn btn-primary text-white py-3 px-5 font-weight-bold">
                </div>
              </div>
            </form>

          </div>
          <div class="col-md-5" data-aos="fade-up" data-aos-delay="200">
            <div class="row">
              <div class="col-md-10 ml-auto contact-info">
                <p><span class="d-block"><span class="ion-ios-location h5 text-primary"></span>Address:</span> <span> <strong>{{ hotel.hotel_address }}</strong></span></p>
                <p><span class="d-block"><span class="ion-ios-telephone h5 text-primary"></span>Phone:</span> <span> <strong>{{ hotel.phone }}</strong></span></p>
                <p><span class="d-block"><span class="ion-ios-email h5 text-primary"></span>Email:</span> <span> <strong>{{ hotel.email }}</strong></span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="section bg-white">
      <div class="container">
        <div class="row justify-content-center text-center mb-5">
          <div class="col-md-7">
            <h2 class="heading" data-aos="fade-up">Our Premium Services</h2>
            <p data-aos="fade-up" data-aos-delay="100">Complete your stay with our selection of premium services available to all guests.</p>
          </div>
        </div>

        <div class="row justify-content-center">
          {% for service in hotel_services %}
          <div class="col-md-6 col-lg-4 mb-4" data-aos="fade-up" {% if forloop.counter0 > 0 %}data-aos-delay="{{ forloop.counter0 }}00"{% endif %}>
            <div class="service text-center">
              <span class="icon d-block mb-3">
                <span class="flaticon-{% if 'Motorbike' in service.name_of_service %}motorcycle{% elif 'Laundry' in service.name_of_service %}laundry{% elif 'Restaurant' in service.name_of_service %}restaurant{% else %}room-service{% endif %} display-4"></span>
              </span>
              <h3 class="mb-3">{{ service.name_of_service }}</h3>
              <p>{{ service.service_description }}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="section testimonial-section bg-light">
      <div class="container">
        <div class="row justify-content-center text-center mb-5">
          <div class="col-md-7">
            <h2 class="heading" data-aos="fade-up">People Says</h2>
          </div>
        </div>
        <div class="row">
          <div class="js-carousel-2 owl-carousel mb-5" data-aos="fade-up" data-aos-delay="200">
            
            <div class="testimonial text-center slider-item">
              <div class="author-image mb-3">
                <img src="{% static 'images/person_1.jpg' %}" alt="Image placeholder" class="rounded-circle mx-auto">
              </div>
              <blockquote>

                <p>&ldquo;A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.&rdquo;</p>
              </blockquote>
              <p><em>&mdash; Jean Smith</em></p>
            </div> 

            <div class="testimonial text-center slider-item">
              <div class="author-image mb-3">
                <img src="{% static 'images/person_2.jpg' %}" alt="Image placeholder" class="rounded-circle mx-auto">
              </div>
              <blockquote>
                <p>&ldquo;Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.&rdquo;</p>
              </blockquote>
              <p><em>&mdash; John Doe</em></p>
            </div>

            <div class="testimonial text-center slider-item">
              <div class="author-image mb-3">
                <img src="{% static 'images/person_3.jpg' %}" alt="Image placeholder" class="rounded-circle mx-auto">
              </div>
              <blockquote>

                <p>&ldquo;When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane.&rdquo;</p>
              </blockquote>
              <p><em>&mdash; John Doe</em></p>
            </div>


            <div class="testimonial text-center slider-item">
              <div class="author-image mb-3">
                <img src="{% static 'images/person_1.jpg' %}" alt="Image placeholder" class="rounded-circle mx-auto">
              </div>
              <blockquote>

                <p>&ldquo;A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.&rdquo;</p>
              </blockquote>
              <p><em>&mdash; Jean Smith</em></p>
            </div> 

            <div class="testimonial text-center slider-item">
              <div class="author-image mb-3">
                <img src="{% static 'images/person_2.jpg' %}" alt="Image placeholder" class="rounded-circle mx-auto">
              </div>
              <blockquote>
                <p>&ldquo;Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.&rdquo;</p>
              </blockquote>
              <p><em>&mdash; John Doe</em></p>
            </div>

            <div class="testimonial text-center slider-item">
              <div class="author-image mb-3">
                <img src="{% static 'images/person_3.jpg' %}" alt="Image placeholder" class="rounded-circle mx-auto">
              </div>
              <blockquote>

                <p>&ldquo;When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane.&rdquo;</p>
              </blockquote>
              <p><em>&mdash; John Doe</em></p>
            </div>

          </div>
            <!-- END slider -->
        </div>

      </div>
    </section>

    
    
    <section class="section bg-image overlay" style="background-image: url('{% static 'images/hero_4.jpg' %}');">
        <div class="container" >
          <div class="row align-items-center">
            <div class="col-12 col-md-6 text-center mb-4 mb-md-0 text-md-left" data-aos="fade-up">
              <h2 class="text-white font-weight-bold">A Best Place To Stay. Reserve Now!</h2>
            </div>
            <div class="col-12 col-md-6 text-center text-md-right" data-aos="fade-up" data-aos-delay="200">
              <a href="{% url 'reservation' %}" class="btn btn-outline-white-primary py-3 text-white px-5">Reserve Now</a>
            </div>
          </div>
        </div>
      </section>

    <footer class="section footer-section">
      <div class="container">
        <div class="row mb-4">
          <div class="col-md-3 mb-5">
            <ul class="list-unstyled link">
              <li><a href="{% url 'about' %}">About Us</a></li>
              <li><a href="{% url 'home' %}">Terms &amp; Conditions</a></li>
              <li><a href="{% url 'home' %}">Privacy Policy</a></li>
             <li><a href="{% url 'rooms' %}">Rooms</a></li>
            </ul>
          </div>
          <div class="col-md-3 mb-5">
            <ul class="list-unstyled link">
              <li><a href="{% url 'rooms' %}">The Rooms &amp; Suites</a></li>
              <li><a href="{% url 'about' %}">About Us</a></li>
              <li><a href="{% url 'contact' %}">Contact Us</a></li>
              <li><a href="{% url 'home' %}">Restaurant</a></li>
            </ul>
          </div>
          <div class="col-md-3 mb-5 pr-md-5 contact-info">
            <!-- <li>198 West 21th Street, <br> Suite 721 New York NY 10016</li> -->
            <p><span class="d-block"><span class="ion-ios-location h5 text-primary"></span>Address:</span> <span> {{ hotel.hotel_address }}</span></p>
            <p><span class="d-block"><span class="ion-ios-telephone h5 text-primary"></span>Phone:</span> <span> {{ hotel.phone }}</span></p>
            <p><span class="d-block"><span class="ion-ios-email h5 text-primary"></span>Email:</span> <span> {{ hotel.email }}</span></p>
          </div>
          <div class="col-md-3 mb-5">
            <p>Sign up for our newsletter</p>
            <form id="newsletter-form" class="footer-newsletter">
              <div class="form-group">
                <input type="email" class="form-control" name="email" placeholder="Email..." required>
                <button type="submit" class="btn"><span class="fa fa-paper-plane"></span></button>
              </div>
            </form>
          </div>
        </div>
        <div class="row pt-5">
          <p class="col-md-6 text-left">
          </p>
            
          <p class="col-md-6 text-right social">
            <a href="#"><span class="fa fa-tripadvisor"></span></a>
            <a href="#"><span class="fa fa-facebook"></span></a>
            <a href="#"><span class="fa fa-twitter"></span></a>
            <a href="#"><span class="fa fa-linkedin"></span></a>
            <a href="#"><span class="fa fa-vimeo"></span></a>
          </p>
        </div>
      </div>
    </footer>
    
    <!-- JavaScript Dependencies -->
    <!-- jQuery and jQuery Migrate -->
    <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
    
    <!-- Bootstrap Dependencies -->
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    
    <!-- Feature Libraries -->
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
    <script src="{% static 'js/jquery.fancybox.min.js' %}"></script>
    
    <!-- Animation Library -->
    <script src="{% static 'js/aos.js' %}"></script>
    
    <!-- Date and Time Pickers -->
    <script src="{% static 'js/bootstrap-datepicker.js' %}"></script> 
    <script src="{% static 'js/jquery.timepicker.min.js' %}"></script> 

    <!-- Custom Site Scripts -->
    <script src="{% static 'js/main.js' %}"></script>

    <!-- Newsletter Form Handling -->
    <script>
      $(document).ready(function() {
        // Handle newsletter form submission
        $('#newsletter-form').on('submit', function(e) {
          // Prevent default form submission
          e.preventDefault();
          
          // Get form elements
          var form = $(this);
          var submitButton = form.find('button[type="submit"]');
          var email = form.find('input[name="email"]').val();
          
          // Disable submit button while processing
          submitButton.prop('disabled', true);
          
          // Submit form via AJAX
          $.ajax({
            url: '{% url "newsletter_signup" %}',
            type: 'POST',
            data: {
              'email': email,
              'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            complete: function() {
              // Reset form and re-enable submit button after completion
              form.find('input[name="email"]').val('');
              submitButton.prop('disabled', false);
            }
          });
        });

        // Helper function to format date for submission (MM/DD/YYYY format)
        function formatDateForSubmit(dateString) {
          if (!dateString) return '';
          
          // If already in MM/DD/YYYY format, return as is
          var dateRegex = /^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/;
          if (dateRegex.test(dateString)) {
            return dateString;
          }
          
          // Try to parse and reformat the date
          var parts = dateString.split('/');
          if (parts.length === 3) {
            var month = parts[0].padStart(2, '0');
            var day = parts[1].padStart(2, '0');
            var year = parts[2];
            return month + '/' + day + '/' + year;
          }
          
          // If format is different, try Date parsing
          var date = new Date(dateString);
          if (!isNaN(date.getTime())) {
            var month = String(date.getMonth() + 1).padStart(2, '0');
            var day = String(date.getDate()).padStart(2, '0');
            var year = date.getFullYear();
            return month + '/' + day + '/' + year;
          }
          
          // Return original if can't parse
          return dateString;
        }

        // Handle reservation form submission
        $('#reservation-form').on('submit', function(e) {
          e.preventDefault();
          
          var form = $(this);
          var submitButton = form.find('input[type="submit"]');
          var formMessages = $('#form-messages');
          
          // Disable submit button
          submitButton.prop('disabled', true);
          submitButton.val('Submitting...');

          // Get form data with formatted dates
          var formData = {
            'name': $('#name').val(),
            'phone': $('#phone').val(),
            'email': $('#email').val(),
            'checkin_date': formatDateForSubmit($('#checkin_date').val()),
            'checkout_date': formatDateForSubmit($('#checkout_date').val()),
            'adults': $('#adults').val(),
            'children': $('#children').val(),
            'room_type': $('#room_type').val(),
            'notes': $('#notes').val(),
            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()
          };

          // Submit via AJAX
          $.ajax({
            url: '{% url "reservation" %}',
            type: 'POST',
            data: formData,
            success: function(response) {
              // Show success message
              formMessages.removeClass('alert-danger').addClass('alert alert-success');
              var totalDays = response.total_days || 0;
              var totalCost = response.total_cost_amount || 0;
              var nightsLabel = totalDays === 1 ? 'night' : 'nights';
              var formattedCost = Number(totalCost).toLocaleString('vi-VN');
              var summary = `${response.message} Booking ID: ${response.booking_id}. Total for ${totalDays} ${nightsLabel}: ₫${formattedCost}`;
              formMessages.text(summary);
              formMessages.show();
              
              // Reset form
              form[0].reset();
              
              // Scroll to message
              $('html, body').animate({
                scrollTop: formMessages.offset().top - 100
              }, 500);
            },
            error: function(xhr) {
              // Show error message
              var errorMsg = 'An error occurred. Please try again.';
              if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMsg = xhr.responseJSON.message;
              }
              formMessages.removeClass('alert-success').addClass('alert alert-danger');
              formMessages.text(errorMsg);
              formMessages.show();
              
              // Scroll to message
              $('html, body').animate({
                scrollTop: formMessages.offset().top - 100
              }, 500);
            },
            complete: function() {
              // Re-enable submit button
              submitButton.prop('disabled', false);
              submitButton.val('Reserve Now');
            }
          });
        });
      });
    </script>
  </body>
</html>
