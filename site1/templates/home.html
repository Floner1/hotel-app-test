<!DOCTYPE HTML>
<html>
  <head>
    {% load static %}
    {% load humanize %}
    <!-- Meta Tags Section -->
    <!-- Essential meta tags for SEO and responsive design -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Home | Thien Tai Hotel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />
    
    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=|Roboto+Sans:400,700|Playfair+Display:400,700">

    <!-- Static Files Section -->
    {% load static %}
    <!-- Core CSS Libraries -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/aos.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.timepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/fancybox.min.css' %}">
    
    <!-- Icon Fonts -->
    <link rel="stylesheet" href="{% static 'fonts/ionicons/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/fontawesome/css/font-awesome.min.css' %}">

    <!-- Google Translate -->
    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({
          pageLanguage: 'en',
          includedLanguages: 'en,vi,zh-CN,ko',
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
          autoDisplay: false
        }, 'google_translate_element');
      }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- Main Theme Style -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    <!-- Custom Styles for Better Formatting -->
    <style>
      /* NAVBAR FIX - Force horizontal layout with color matching site logo */
      .inline-nav {
        display: flex !important;
        flex: 1 !important;
      }
      
      .inline-nav ul {
        display: flex !important;
        flex-direction: row !important;
        list-style: none !important;
        margin: 0 !important;
        padding: 0 !important;
        gap: 0 !important;
        width: 100% !important;
        justify-content: space-evenly !important;
      }
      
      .inline-nav ul li {
        display: inline-block !important;
      }
      
      /* Match nav link colors to site logo - white by default, black on scroll */
      .inline-nav ul li a {
        color: #fff !important;
        transition: color 0.3s ease !important;
        font-size: 18px !important;
      }
      
      .site-header.scrolled .inline-nav ul li a {
        color: #000 !important;
        font-size: 18px !important;
      }
      
      .inline-nav ul li a:hover {
        color: #f8b739 !important;
      }
      
      .site-header.scrolled .inline-nav ul li a:hover {
        color: #f8b739 !important;
      }
      
      /* Responsive: Hide inline nav on small/medium screens, show hamburger only */
      @media (max-width: 991.98px) {
        .inline-nav {
          display: none !important;
        }
      }
      
      /* LOGO FIX - Prevent hotel name from wrapping to multiple lines */
      .site-logo {
        white-space: nowrap !important;
      }
      
      /* PAGE HEADING AND BREADCRUMB FONT SIZES */
      .site-hero-inner h1.heading {
        font-size: 72px !important;
      }
      
      .custom-breadcrumbs {
        font-size: 20px !important;
      }
      
      .custom-breadcrumbs li {
        font-size: 20px !important;
      }
      
      /* ROOM IMAGE CONSISTENCY */
      .room .img-wrap img {
        width: 100% !important;
        height: 240px !important;
        object-fit: cover !important;
        display: block !important;
      }
      
      /* Room Cards Styling */
      .room-info {
        text-align: center !important;
      }
      
      .room-info h2 {
        font-size: 1.75rem !important;
        font-weight: 600 !important;
        margin-bottom: 0.75rem !important;
        color: #333 !important;
        white-space: nowrap !important;
      }
      
      .room-info span {
        color: #f8b739 !important;
        font-size: 1.125rem !important;
        font-weight: 600 !important;
        letter-spacing: 2px !important;
        display: block !important;
      }
      
      /* LANGUAGE SELECTOR */
      .language-selector {
        display: inline-block !important;
        position: relative !important;
      }
      
      .language-selector .lang-button {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        padding: 5px !important;
        color: #fff !important;
        font-size: 18px !important;
      }
      
      .site-header.scrolled .language-selector .lang-button {
        color: #000 !important;
      }
      
      .language-selector .lang-dropdown {
        display: none !important;
        position: absolute !important;
        top: 100% !important;
        right: 0 !important;
        background: rgba(0, 0, 0, 0.85) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 4px !important;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5) !important;
        z-index: 1000 !important;
        min-width: 180px !important;
        margin-top: -10px !important;
        padding: 20px 0 10px 0 !important;
      }
      
      .site-header.scrolled .language-selector .lang-dropdown {
        background: rgba(255, 255, 255, 0.98) !important;
        border: 1px solid rgba(0, 0, 0, 0.2) !important;
      }
      
      .language-selector:hover .lang-dropdown {
        display: block !important;
      }
      
      .lang-dropdown a {
        display: block !important;
        padding: 12px 15px !important;
        color: #fff !important;
        text-decoration: none !important;
        font-size: 16px !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
        white-space: nowrap !important;
      }
      
      .site-header.scrolled .lang-dropdown a {
        color: #000 !important;
      }
      
      .lang-dropdown a:hover {
        background: rgba(248, 183, 57, 0.2) !important;
        color: #f8b739 !important;
      }
      
      .lang-dropdown img {
        width: 24px !important;
        height: 16px !important;
        margin-right: 8px !important;
        vertical-align: middle !important;
      }
      
      /* Hide Google Translate default elements */
      .goog-te-banner-frame.skiptranslate {
        display: none !important;
      }
      
      body {
        top: 0px !important;
      }
      
      #google_translate_element {
        display: none !important;
      }
      
      /* FOOTER FIX - Force labels and values on separate lines */
      .footer-section .contact-info .contact-label {
        display: block !important;
        font-weight: normal !important;
        margin-bottom: 5px !important;
      }
      
      .footer-section .contact-info .contact-value {
        display: block !important;
        font-weight: normal !important;
      }
      
      /* Room Cards Styling */
      .room-info h2 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
      }
      
      .room-info span {
        color: #f8b739;
        font-size: 0.875rem;
        font-weight: 600;
        letter-spacing: 2px;
      }
      
      /* Services Section Styling */
      .service {
        padding: 2rem 1rem;
        transition: transform 0.3s ease;
        height: 100%;
      }
      
      .service:hover {
        transform: translateY(-5px);
      }
      
      .service .icon {
        color: #f8b739;
      }
      
      /* Services row spacing - spread items evenly */
      .section .row {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        align-items: stretch;
      }
      
      /* Toast Notification Styles */
      .toast-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #28a745;
        color: white;
        padding: 15px 25px;
        border-radius: 5px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        display: none;
        animation: slideInRight 0.4s ease-out;
      }
      
      .toast-notification.show {
        display: block;
      }
      
      .toast-notification.error {
        background-color: #dc3545;
      }
      
      .toast-notification .toast-icon {
        margin-right: 10px;
        font-size: 18px;
      }
      
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <!-- Toast Notification -->
    <div id="toast-notification" class="toast-notification">
      <span class="toast-icon">‚úì</span>
      <span class="toast-message"></span>
    </div>
    
    <header class="site-header js-site-header">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-6 col-lg-3 site-logo" data-aos="fade"><a href="{% url 'home' %}">{{ hotel_name }}</a></div>
          <div class="col-6 col-lg-9">
            
            <!-- Inline Navigation for Desktop -->
            <div class="d-none d-lg-block inline-nav" data-aos="fade">
              <ul>
                <li class="active"><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'rooms' %}">Rooms</a></li>
                <li><a href="{% url 'about' %}">About</a></li>
                <li><a href="{% url 'contact' %}">Contact</a></li>
                <li><a href="{% url 'reservation' %}">Reservation</a></li>
                <li class="language-selector">
                  <button class="lang-button">üåê Language</button>
                  <div class="lang-dropdown">
                    <a href="#" data-lang="en">üá¨üáß English</a>
                    <a href="#" data-lang="vi">üáªüá≥ Ti·∫øng Vi·ªát</a>
                    <a href="#" data-lang="zh">üá®üá≥ ‰∏≠Êñá</a>
                    <a href="#" data-lang="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</a>
                  </div>
                </li>
                {% if user.is_authenticated %}
                  {% if user.role == 'admin' or user.role == 'staff' %}
                    <li><a href="{% url 'admin_reservations' %}">Dashboard</a></li>
                  {% endif %}
                  <li><a href="{% url 'logout' %}">Logout</a></li>
                {% else %}
                  <li><a href="{% url 'login' %}">Login</a></li>
                  <li><a href="{% url 'register' %}">Register</a></li>
                {% endif %}
              </ul>
            </div>

            <!-- Mobile Menu Toggle -->
            <div class="site-menu-toggle js-site-menu-toggle d-lg-none" data-aos="fade">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <!-- END menu-toggle -->

            <div class="site-navbar js-site-navbar">
              <nav role="navigation">
                <div class="container">
                  <div class="row full-height align-items-center">
                    <div class="col-md-6 mx-auto">
                      <ul class="list-unstyled menu">
                        <li class="active"><a href="{% url 'home' %}">Home</a></li>
                        <li><a href="{% url 'rooms' %}">Rooms</a></li>
                        <li><a href="{% url 'about' %}">About</a></li>
                        <li><a href="{% url 'contact' %}">Contact</a></li>
                        <li><a href="{% url 'reservation' %}">Reservation</a></li>
                        {% if user.is_authenticated %}
                          {% if user.role == 'admin' or user.role == 'staff' %}
                            <li><a href="{% url 'admin_reservations' %}">Dashboard</a></li>
                          {% endif %}
                          <li><a href="{% url 'logout' %}">Logout ({{ user.username }})</a></li>
                        {% else %}
                          <li><a href="{% url 'login' %}">Login</a></li>
                          <li><a href="{% url 'register' %}">Create Account</a></li>
                        {% endif %}
                      </ul>
                    </div>
                  </div>
                </div>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- END head -->

    <section class="site-hero overlay" style="background-image: url({% static 'images/hero_4.jpg' %})" data-stellar-background-ratio="0.5">
      <div class="container">
        <div class="row site-hero-inner justify-content-center align-items-center">
          <div class="col-md-10 text-center" data-aos="fade-up">
            <h1 class="heading" style="white-space: nowrap;">Welcome to {{ hotel_name }}<br><span style="font-size: 0.9em;">Relax Your Soul</span></h1>
          </div>
        </div>
      </div>

      <a class="mouse smoothscroll" href="#next">
        <div class="mouse-icon">
          <span class="mouse-wheel"></span>
        </div>
      </a>
    </section>
    <!-- END section -->

    <section class="py-5 bg-light">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-12 col-lg-7 ml-auto order-lg-2 position-relative mb-5" data-aos="fade-up">
            <figure class="img-absolute">
              {% if request.user.is_authenticated and request.user.is_staff %}
              <div class="admin-image-container" data-image-id="food-1">
                <img src="{% static 'images/food-1.jpg' %}" alt="Free Website Template by Templateux" class="img-fluid">
                <div class="admin-image-overlay">
                  <button class="admin-upload-btn" onclick="openImageUpload('food-1', '{% static 'images/food-1.jpg' %}')"><i class="fa fa-upload"></i> Upload Image</button>
                </div>
              </div>
              {% else %}
              <img src="{% static 'images/food-1.jpg' %}" alt="Free Website Template by Templateux" class="img-fluid">
              {% endif %}
            </figure>
            {% if request.user.is_authenticated and request.user.is_staff %}
            <div class="admin-image-container" data-image-id="img-1">
              <img src="{% static 'images/img_1.jpg' %}" alt="Image" class="img-fluid rounded">
              <div class="admin-image-overlay">
                <button class="admin-upload-btn" onclick="openImageUpload('img-1', '{% static 'images/img_1.jpg' %}')"><i class="fa fa-upload"></i> Upload Image</button>
              </div>
            </div>
            {% else %}
            <img src="{% static 'images/img_1.jpg' %}" alt="Image" class="img-fluid rounded">
            {% endif %}
          </div>
          <div class="col-md-12 col-lg-5 order-lg-1" data-aos="fade-up">
            <h2 class="heading">Welcome!</h2>
            <p class="mb-4">Thi√™n T√†i Hotel is a modern, centrally located hotel in Ho Chi Minh City offering comfortable, individually designed rooms with contemporary amenities. Featuring a rooftop terrace, on-site restaurant and caf√©, and attentive 24-hour service, the hotel provides a convenient and relaxing stay close to major attractions, shopping areas, and local landmarks.</p>
            <p><a href="{% url 'about' %}" class="btn btn-primary text-white py-2 mr-3">Learn More</a> <span class="mr-3 font-family-serif"><em>or</em></span> <a href="{% url 'contact' %}" class="btn btn-outline-primary py-2">Contact</a></p>
          </div>
          
        </div>
      </div>
    </section>

    <!-- Rooms and Suites Section -->
    <!-- Showcase of available room types and their pricing -->
    <section class="section slider-section" style="background-color: white;">
      <div class="container">
        <div class="row justify-content-center text-center mb-5">
          <div class="col-md-7">
            <h2 class="heading" data-aos="fade-up" style="font-size: 3.5rem !important;">Rooms &amp; Suites</h2>
            <p data-aos="fade-up" data-aos-delay="100" style="font-size: 1.25rem !important;">Our rooms offer a quiet place to rest. Simple layouts, comfortable beds, and a calm setting make it easy to relax. Each room is clean, well kept, and designed for a good night's sleep. Whether you stay one night or longer, you will have everything you need to feel comfortable.</p>
          </div>
        </div>
      </div>
      
      <div class="logo-loop-container" data-aos="fade-up" data-aos-delay="200">
        <div class="logo-loop-track">
          <div class="logo-loop-item">
            <img src="{% static 'images/single bed.png' %}" alt="1 Bed No Window" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/double room.png' %}" alt="2 Bed No Window Room" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/window room.png' %}" alt="1 Bed With Window" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/balcony.png' %}" alt="1 Bed With Balcony" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/condotel.png' %}" alt="2 Bed & Balcony Condotel" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/single bed.png' %}" alt="1 Bed No Window" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/double room.png' %}" alt="2 Bed No Window Room" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/window room.png' %}" alt="1 Bed With Window" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/balcony.png' %}" alt="1 Bed With Balcony" />
          </div>
          <div class="logo-loop-item">
            <img src="{% static 'images/condotel.png' %}" alt="2 Bed & Balcony Condotel" />
          </div>
        </div>
      </div>
      
      <style>
        .logo-loop-container { width: 100%; overflow: hidden; position: relative; padding: 40px 0; background: linear-gradient(to right, rgba(248, 248, 248, 1) 0%, transparent 10%, transparent 90%, rgba(248, 248, 248, 1) 100%); }
        .logo-loop-track { display: flex; gap: 60px; animation: scroll 22s linear infinite; will-change: transform; }
        .logo-loop-item { flex-shrink: 0; transition: transform 0.3s ease; }
        .logo-loop-item:hover { transform: scale(1.1); }
        .logo-loop-item img { height: 280px; width: auto; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(calc(-50%)); } }
        @media (max-width: 768px) { .logo-loop-item img { height: 200px; } .logo-loop-track { gap: 30px; } }
      </style>
    </section>

    <section class="section services-section bg-light">
      <div class="container">
        <div class="row justify-content-center text-center mb-5">
          <div class="col-md-7">
            <h2 class="heading" data-aos="fade-up" style="font-size: 3.5rem !important;">Our Premium Services</h2>
            <p data-aos="fade-up" data-aos-delay="100" style="font-size: 1.25rem !important; color: #6c757d;">Making your stay comfortable and memorable with our range of exclusive services.</p>
          </div>
        </div>

        <div class="row justify-content-center">
          {% for service in hotel_services %}
          <div class="col-md-6 col-lg-4 mb-4" data-aos="fade-up" {% if forloop.counter0 > 0 %}data-aos-delay="{{ forloop.counter0 }}00"{% endif %}>
            <div class="service text-center bg-white p-4 rounded shadow-sm" style="transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-10px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='';"><h3 class="mb-3" style="font-weight: 600;">{{ service.name_of_service }}</h3>
              <p style="color: #6c757d; line-height: 1.8;">{{ service.service_description }}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <!-- Find Us Section -->
    <section class="section testimonial-section bg-light">
      <div class="container-fluid px-0">
        <div class="row justify-content-center text-center mb-5">
          <div class="col-md-7">
            <h2 class="heading" data-aos="fade-up">Find Us</h2>
          </div>
        </div>
        <div class="row no-gutters">
          <div class="col-12" data-aos="fade-up" data-aos-delay="200">
            <!-- Google Map -->
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d6083.477482324672!2d106.68195077662561!3d10.768664389379548!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752f3d9ad5dd29%3A0xd002ee29a19b9caf!2zVGhpw6puIFTDoGkgSG90ZWw!5e0!3m2!1sen!2s!4v1769936238563!5m2!1sen!2s" width="100%" height="600" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
        </div>
      </div>
    </section>

    <section class="section bg-image overlay" style="background-image: url('{% static 'images/hero_4.jpg' %}');">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-12 col-md-6 text-center mb-4 mb-md-0 text-md-left" data-aos="fade-up">
            <h2 class="text-white font-weight-bold">A Best Place To Stay.<br>Reserve Now!</h2>
          </div>
          <div class="col-12 col-md-6 text-center text-md-right" data-aos="fade-up" data-aos-delay="200">
            <a href="{% url 'reservation' %}" class="btn btn-outline-white-primary py-3 text-white px-5">Reserve Now</a>
          </div>
        </div>
      </div>
    </section>

    <footer class="section footer-section">
      <div class="container">
        <div class="row mb-4">
          <div class="col-md-3 mb-5">
            <ul class="list-unstyled link">
              <li><a href="{% url 'about' %}">About Us</a></li>
              <li><a href="{% url 'home' %}">Terms &amp; Conditions</a></li>
              <li><a href="{% url 'home' %}">Privacy Policy</a></li>
            </ul>
          </div>
          <div class="col-md-3 mb-5">
            <ul class="list-unstyled link">
              <li><a href="{% url 'about' %}">About Us</a></li>
              <li><a href="{% url 'contact' %}">Contact Us</a></li>
              <li><a href="{% url 'reservation' %}">Reservation</a></li>
            </ul>
          </div>
          <div class="col-md-3 mb-5 contact-info">
            <div class="contact-item">
              <span class="contact-label">Address:</span>
              <span class="contact-value">{{ hotel.hotel_address }}</span>
            </div>
            <div class="contact-item">
              <span class="contact-label">Phone:</span>
              <span class="contact-value">{{ hotel.phone }}</span>
            </div>
            <div class="contact-item">
              <span class="contact-label">Email:</span>
              <span class="contact-value">{{ hotel.email }}</span>
            </div>
          </div>
          <div class="col-md-3 mb-5">
            <p>Sign up for our newsletter</p>
            <form id="newsletter-form" class="footer-newsletter">
              <div class="form-group">
                <input type="email" class="form-control" name="email" placeholder="Email..." required>
                <button type="submit" class="btn"><span class="fa fa-paper-plane"></span></button>
              </div>
            </form>
          </div>
        </div>
        <div class="row pt-5">
          <p class="col-md-6 text-left">
          </p>
            
          <p class="col-md-6 text-right social">
            <a href="#"><span class="fa fa-tripadvisor"></span></a>
            <a href="#"><span class="fa fa-facebook"></span></a>
            <a href="#"><span class="fa fa-twitter"></span></a>
            <a href="#"><span class="fa fa-linkedin"></span></a>
            <a href="#"><span class="fa fa-vimeo"></span></a>
          </p>
        </div>
      </div>
    </footer>
    
    <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
    <script src="{% static 'js/jquery.fancybox.min.js' %}"></script>
    
    <script src="{% static 'js/aos.js' %}"></script>
    
    <script src="{% static 'js/bootstrap-datepicker.js' %}"></script> 
    <script src="{% static 'js/jquery.timepicker.min.js' %}"></script> 

    <script src="{% static 'js/main.js' %}"></script>

    <!-- Hidden Google Translate Widget -->
    <div id="google_translate_element" style="display: none;"></div>

    <script>
      // Language selector functionality
      $(document).ready(function() {
        // Keep dropdown open on click and close when clicking outside
        $('.language-selector').on('click', function(e) {
          e.stopPropagation();
          $(this).addClass('keep-open');
        });
        
        $(document).on('click', function() {
          $('.language-selector').removeClass('keep-open');
        });
        
        // Add CSS to keep open when clicked
        $('<style>.language-selector.keep-open .lang-dropdown { display: block !important; }</style>').appendTo('head');
        
        // Handle language selection with a completely different approach
        $('.lang-dropdown a').on('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          var lang = $(this).data('lang');
          console.log('Language change requested:', lang);
          
          $('.language-selector').removeClass('keep-open');
          
          // Direct language mapping
          var langCode = lang;
          if (lang === 'zh') langCode = 'zh-CN';
          
          // Wait for widget to be ready and trigger translation
          var maxAttempts = 20;
          var attempt = 0;
          
          var triggerInterval = setInterval(function() {
            attempt++;
            
            // Method 1: Try to find and use the combo box
            var combo = document.querySelector('.goog-te-combo');
            if (combo && combo.options) {
              // Find the option that matches our language
              for (var i = 0; i < combo.options.length; i++) {
                if (combo.options[i].value === langCode) {
                  combo.selectedIndex = i;
                  
                  // Fire all possible events
                  if (document.createEvent) {
                    var evt = document.createEvent('HTMLEvents');
                    evt.initEvent('change', true, true);
                    combo.dispatchEvent(evt);
                  } else if (combo.fireEvent) {
                    combo.fireEvent('onchange');
                  }
                  
                  console.log('Translation triggered successfully for:', langCode);
                  clearInterval(triggerInterval);
                  return;
                }
              }
            }
            
            // Method 2: Try to access the Google Translate object directly
            if (typeof google !== 'undefined' && google.translate && google.translate.TranslateElement) {
              try {
                var frame = document.querySelector('.goog-te-menu-frame');
                if (frame) {
                  var frameDoc = frame.contentDocument || frame.contentWindow.document;
                  var langLink = frameDoc.querySelector('a[class*="' + langCode + '"]');
                  if (langLink) {
                    langLink.click();
                    console.log('Translation via frame click for:', langCode);
                    clearInterval(triggerInterval);
                    return;
                  }
                }
              } catch(err) {
                console.log('Frame method failed:', err);
              }
            }
            
            if (attempt >= maxAttempts) {
              console.log('Translation failed after', maxAttempts, 'attempts');
              clearInterval(triggerInterval);
            }
          }, 200);
        });
      });
    </script>

    <script>
      // Toast notification function
      function showToast(message, isError = false) {
        var toast = $('#toast-notification');
        toast.find('.toast-message').text(message);
        
        if (isError) {
          toast.addClass('error');
          toast.find('.toast-icon').text('‚úó');
        } else {
          toast.removeClass('error');
          toast.find('.toast-icon').text('‚úì');
        }
        
        toast.addClass('show');
        
        setTimeout(function() {
          toast.removeClass('show');
        }, 3000);
      }
      
      // Check for Django messages and display as toast
      {% if messages %}
        {% for message in messages %}
          showToast('{{ message }}', {% if 'error' in message.tags %}true{% else %}false{% endif %});
        {% endfor %}
      {% endif %}
      
      $(document).ready(function() {
        $('#newsletter-form').on('submit', function(e) {
          e.preventDefault();
          
          var form = $(this);
          var submitButton = form.find('button[type="submit"]');
          var email = form.find('input[name="email"]').val();
          
          // Disable the submit button
          submitButton.prop('disabled', true);
          
          $.ajax({
            url: '{% url "newsletter_signup" %}',
            type: 'POST',
            data: {
              'email': email,
              'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            complete: function() {
              // Clear the form and re-enable the submit button
              form.find('input[name="email"]').val('');
              submitButton.prop('disabled', false);
            }
          });
        });
      });
    </script>
    
    {% if request.user.is_authenticated and request.user.is_staff %}
    <!-- Admin Image Upload Modal -->
    <div id="imageUploadModal" class="image-upload-modal">
      <div class="image-upload-content">
        <div class="image-upload-header">
          <h2>Upload Image</h2>
          <button class="close-upload-modal" onclick="closeImageUpload()">&times;</button>
        </div>
        <div class="image-upload-body">
          <div class="current-image-preview">
            <h4>Current Image</h4>
            <img id="currentImagePreview" src="" alt="Current Image" />
          </div>
          <div class="upload-zone" id="uploadZone">
            <i class="fa fa-cloud-upload" style="font-size: 48px; color: var(--primary-color); margin-bottom: 15px;"></i>
            <p><strong>Drag & Drop your image here</strong></p>
            <p style="color: #999; margin: 10px 0;">or</p>
            <input type="file" id="imageFileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
            <button class="btn-browse" onclick="document.getElementById('imageFileInput').click()">Browse Files</button>
            <p style="font-size: 12px; color: #999; margin-top: 15px;">Supports: JPG, PNG, GIF (Max 5MB)</p>
          </div>
          <div class="new-image-preview" id="newImagePreview" style="display: none;">
            <h4>New Image</h4>
            <img id="previewImage" src="" alt="Preview" />
            <button class="btn btn-secondary mt-3" onclick=\"clearPreview()\">Clear</button>
          </div>
          <input type=\"hidden\" id=\"imageIdInput\">
        </div>
        <div class=\"image-upload-footer\">
          <button class=\"btn btn-secondary\" onclick=\"closeImageUpload()\">Cancel</button>
          <button class=\"btn btn-primary\" id=\"uploadButton\" onclick=\"uploadImage()\" disabled>Upload Image</button>
        </div>
      </div>
    </div>

    <style>
      .admin-image-container {
        position: relative;
        display: inline-block;
        width: 100%;
      }

      .admin-image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: inherit;
      }

      .admin-image-container:hover .admin-image-overlay {
        opacity: 1;
      }

      .admin-upload-btn {
        background: linear-gradient(135deg, #6c63ff 0%, #5548c8 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
      }

      .admin-upload-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
      }

      .image-upload-modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        animation: fadeIn 0.3s ease;
      }

      .image-upload-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .image-upload-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 700px;
        max-height: 90vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease;
      }

      .image-upload-header {
        padding: 20px 30px;
        border-bottom: 2px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .image-upload-header h2 {
        margin: 0;
        color: #333;
        font-weight: 600;
      }

      .close-upload-modal {
        background: none;
        border: none;
        font-size: 32px;
        cursor: pointer;
        color: #999;
        transition: color 0.3s ease;
      }

      .close-upload-modal:hover {
        color: #333;
      }

      .image-upload-body {
        padding: 30px;
      }

      .current-image-preview, .new-image-preview {
        margin-bottom: 20px;
      }

      .current-image-preview h4, .new-image-preview h4 {
        margin-bottom: 15px;
        color: #333;
        font-weight: 600;
      }

      .current-image-preview img, .new-image-preview img {
        max-width: 100%;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .upload-zone {
        border: 3px dashed #ddd;
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        transition: all 0.3s ease;
        background: #fafafa;
      }

      .upload-zone.dragover {
        border-color: #6c63ff;
        background: #f0efff;
      }

      .btn-browse {
        background: #6c63ff;
        color: white;
        border: none;
        padding: 10px 30px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-browse:hover {
        background: #5548c8;
        transform: translateY(-2px);
      }

      .image-upload-footer {
        padding: 20px 30px;
        border-top: 2px solid #f0f0f0;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    </style>

    <script>
      let currentImageId = '';

      function openImageUpload(imageId, currentImageUrl) {
        currentImageId = imageId;
        document.getElementById('imageIdInput').value = imageId;
        document.getElementById('currentImagePreview').src = currentImageUrl;
        document.getElementById('imageUploadModal').classList.add('show');
        clearPreview();
      }

      function closeImageUpload() {
        document.getElementById('imageUploadModal').classList.remove('show');
        clearPreview();
      }

      function clearPreview() {
        document.getElementById('newImagePreview').style.display = 'none';
        document.getElementById('previewImage').src = '';
        document.getElementById('imageFileInput').value = '';
        document.getElementById('uploadButton').disabled = true;
      }

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
          displayPreview(file);
        }
      }

      function displayPreview(file) {
        if (file.size > 5 * 1024 * 1024) {
          showToast('File size must be less than 5MB', true);
          return;
        }

        if (!file.type.startsWith('image/')) {
          showToast('Please select an image file', true);
          return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('previewImage').src = e.target.result;
          document.getElementById('newImagePreview').style.display = 'block';
          document.getElementById('uploadButton').disabled = false;
        };
        reader.readAsDataURL(file);
      }

      function uploadImage() {
        const fileInput = document.getElementById('imageFileInput');
        const imageId = document.getElementById('imageIdInput').value;
        
        if (!fileInput.files.length) {
          showToast('Please select an image', true);
          return;
        }

        const formData = new FormData();
        formData.append('image', fileInput.files[0]);
        formData.append('image_id', imageId);
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

        document.getElementById('uploadButton').disabled = true;
        document.getElementById('uploadButton').textContent = 'Uploading...';

        fetch('{% url \"upload_image\" %}', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            showToast(data.message, false);
            closeImageUpload();
            // Reload the page to show the new image
            setTimeout(() => location.reload(), 1500);
          } else {
            showToast(data.message, true);
            document.getElementById('uploadButton').disabled = false;
            document.getElementById('uploadButton').textContent = 'Upload Image';
          }
        })
        .catch(error => {
          showToast('Upload failed: ' + error.message, true);
          document.getElementById('uploadButton').disabled = false;
          document.getElementById('uploadButton').textContent = 'Upload Image';
        });
      }

      // Drag and drop functionality
      const uploadZone = document.getElementById('uploadZone');
      if (uploadZone) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          uploadZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
          uploadZone.addEventListener(eventName, () => uploadZone.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
          uploadZone.addEventListener(eventName, () => uploadZone.classList.remove('dragover'), false);
        });

        uploadZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;
          if (files.length) {
            document.getElementById('imageFileInput').files = files;
            displayPreview(files[0]);
          }
        }
      }

      // Close modal when clicking outside
      window.onclick = function(event) {
        const modal = document.getElementById('imageUploadModal');
        if (event.target === modal) {
          closeImageUpload();
        }
      }
    </script>
    {% endif %}
  </body>
</html>